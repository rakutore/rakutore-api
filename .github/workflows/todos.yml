name: daily-todos

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch: {}

jobs:
  run:
    runs-on: ubuntu-latest
    env:
      API_URL: ${{ secrets.API_URL }}
      API_KEY: ${{ secrets.API_KEY }}

    steps:
      - name: 1) å¥åº·ãƒã‚§ãƒƒã‚¯ (/healthz)
        run: |
          set -euo pipefail
          curl -fsS "$API_URL/healthz"
          echo "healthz OK"      - name: 2) ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ  (DEBUG)
        run: |
          set -euo pipefail
          TITLE="å®šæœŸã‚¿ã‚¹ã‚¯ $(date +'%Y-%m-%d')"

          echo "ğŸ” API_URL ã®ä¸­èº«:"
          printf '[%s]\n' "$API_URL"

          echo "ğŸ” å®Ÿéš›ã«å©ãURL:"
          printf '[%s/todos]\n' "$API_URL"

          echo "ğŸ” curl å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:"
          echo curl -v -X POST "$API_URL/todos"

          echo "---------------- curl -v start ----------------"
          curl -v \
            -X POST "$API_URL/todos" \
            -H "Content-Type: application/json" \
            -H "x-api-key: $API_KEY" \
            -d "{\"title\":\"$TITLE\"}" \
            -o /tmp/created.json \
            -w '\nHTTP_STATUS=%{http_code}\n'
          echo "---------------- curl -v end ----------------"



      - name: 3) çµæœã‚’è¡¨ç¤º
        run: |
          echo "----- CREATED -----"
          cat /tmp/created.json
